# Documentation on the toolchain and build process for Unix and Windows systems

This document describes the toolchain used to compile the Wings 3D project on both Unix and Windows systems.

## Unix Toolchain overview

Building the project on a Unix system is usually simple. You will need the following:

- **Erlang/OTP 25.3.1 or later** because the project is written in Erlang.
- **rebar3** being the dependency tool for Erlang.
- **GNU Make** being the tool to compile and orchestrate the build.
- **C/C++ compiler** (GCC or Clang) to build native extensions for graphics operations.
- **OpenGL** development headers (usually included with your graphics drivers).
- **Git** to fetch external dependencies automatically.

### Optional dependencies

- **OpenCL** headers and drivers for GPU-accelerated features (not required, build continues without it).
- **libigl and eigen** libraries are automatically downloaded during compilation for advanced geometry operations (64-bit systems only).

## Installing on different Linux distributions

### Debian/Ubuntu/Mint

```bash
sudo apt-get update
sudo apt-get install erlang erlang-wx erlang-dev build-essential
sudo apt-get install libgl1-mesa-dev libglu1-mesa-dev libwxgtk3.2-dev
```

```bash
sudo apt-get install make
```

```bash
sudo apt-get install ocl-icd-opencl-dev
```

```bash
sudo apt-get install clang
```

```bash
sudo apt-get install gcc g++
```

```bash
sudo apt-get install libeigen3-dev
```

```bash
sudo apt-get install rebar3
```

# Windows Toolchain overview

Building Wings3D on Windows is more complex than on Unix but there are two approaches:

1. **WSL Cross-compilation** (Recommended) - Build from Windows Subsystem for Linux
2. **MSVC compilation**

## WSL Cross-compilation (Recommended)

This method uses WSL (Windows Subsystem for Linux) to build Windows binaries. It's the easiest way to build Wings3D on Windows.

### Prerequisites

- **Windows 10 or Windows 11** with WSL2 enabled
- **Erlang/OTP 26.0 or later** installed on Windows (download from https://erlang.org)
- **WSL2 with Ubuntu** or Debian distribution
- **Git for Windows**

**Important:** Erlang must be version 26.0 or later for Windows builds (not 25.x like on Unix).

### Setting up WSL

1. Enable WSL2:
```powershell
# Run PowerShell as Administrator
wsl --install
wsl --set-default-version 2
```

2. Install Ubuntu:
```powershell
wsl --install -d Ubuntu-22.04
```

3. Install Erlang on Windows (not in WSL):
   - Download the Windows installer from https://erlang.org
   - Install to `C:\Program Files\Erlang OTP`
   - Add `C:\Program Files\Erlang OTP\bin` to Windows PATH

4. Open WSL and navigate to your Wings3D directory:
```bash
cd /mnt/c/Users/YourName/wings  # or wherever you cloned it
```

5. Run the WSL setup script:
```bash
cd win32
./SetupWSLcross.bat
cd ..
```

This script installs the MinGW-w64 cross-compiler and required libraries in WSL.

# Common Build Issues and Solutions

If you have a compilation issue, first thing to see is if you have missing directories or files, as it can easily occure on this project.

**VERY IMPORTANT** you must have the followings folders and files:

- `ebin/` - Compiled Erlang modules (.beam files) for core application
- `plugins/default/` - Default plugin modules
- `plugins/import_export/` - Import/export plugins
- `plugins/primitives/` - Primitive shape plugins
- `plugins/commands/` - Command plugins
- `plugins/autouv/` - UV mapping plugins
- `priv/` - Native extensions (.so or .dll files)
- `WINGS-VERSION-GEN` - Script to generate version information
- `vsn.mk` - Makefile fragment for version info (generated by WINGS-VERSION-GEN)
- `erl.mk` - Makefile fragment for Erlang compilation settings

If you don't have any of these, the build will fail. Just create the missing directories and files as needed. For example, if you don't have `ebin/`, create it with `mkdir ebin`. If you don't have `plugins/default/`, create it with `mkdir -p plugins/default`.

If you don't have WINGS-VERSION-GEN, create a blank file with that name and write the following content:
```bash
#!/bin/sh

VSN_MK=vsn.mk

if test -f version
then
	VSN=`cat version` || exit 1
elif test -d .git
then
	VSN=`git describe --tags --abbrev=4 HEAD 2>/dev/null` || VSN="2.4.1"
else
	VSN="2.4.1"
fi

VSN=`expr "$VSN" : v*'\(.*\)'`

if test -r $VSN_MK
then
	VC=`sed -e 's/^WINGS_VSN=//' < $VSN_MK`
else
	VC=unset
fi

test "$VSN" = "$VC" || {
	echo "WINGS_VSN=$VSN" >$VSN_MK
}
```

vsn.mk should be generated by running `make` in the project root, and it should contain a line like:
```bash
WINGS_VSN=2.4.1
```

## OpenCL build fails

**Problem:** Error building the cl dependency

**Solution:** This is optional. The build continues without OpenCL support. If you want OpenCL:
- Install OpenCL headers: `sudo apt-get install ocl-icd-opencl-dev` (Ubuntu)
- Install vendor-specific drivers (NVIDIA CUDA, AMD ROCm, Intel OpenCL)

## Cross-compilation fails on Windows

**Problem:** WSL build can't find Windows Erlang

**Solution:**
- Verify Erlang is installed on Windows (not in WSL)
- Check the path in WSL: `ls /mnt/c/Program\ Files/Erlang\ OTP/`
- Ensure Windows PATH includes Erlang bin directory

# Additional Resources

- **Original build instructions:** See `BUILD.unix` and `BUILD.win32` in the project root
- **Erlang downloads:** https://erlang.org/downloads
- **wxWidgets:** https://wxwidgets.org
- **Project repository:** https://github.com/Despacitugo/wings3d